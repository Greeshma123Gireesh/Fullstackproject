<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Profile Edit</title>
  <link rel="stylesheet" href="style/profile.css">
  <style>
    /* Navbar Styles */
    .navbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
      background-color: #333;
      color: white;
    }
    .logo {
      font-size: 24px;
      font-weight: bold;
    }
    .right-section {
      display: flex;
      align-items: center;
      gap: 20px;
    }
    .welcome-message {
      font-size: 16px;
    }
    .account {
      position: relative;
      cursor: pointer;
    }
    .dropdown-content {
      display: none;
      position: absolute;
      right: 0;
      background-color: white;
      color: black;
      min-width: 160px;
      box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
      z-index: 1;
      border-radius: 5px;
      overflow: hidden;
    }
    .dropdown-content a {
      padding: 12px 16px;
      display: block;
      text-decoration: none;
      color: black;
    }
    .dropdown-content a:hover {
      background-color: #f1f1f1;
    }
    .account:hover .dropdown-content {
      display: block;
    }
  </style>
</head>

<body>

  <!-- Navbar -->
  <div class="navbar">
    <div class="logo">Logo</div>

    <div class="right-section">
      <div class="welcome-message" id="welcomeUser">Welcome, User</div>
      <div class="account">
        Account
        <div class="dropdown-content">
          <a href="profile.html">Profile</a>
          <a href="#" onclick="logout()">Logout</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Profile Form -->
  <div class="container">
    <h1>My Account</h1>

    <form id="profileForm">
      <label>First Name</label>
      <input type="text" id="firstName" placeholder="Enter first name" required>

      <label>Last Name</label>
      <input type="text" id="lastName" placeholder="Enter last name" required>

      <label>Email</label>
      <input type="email" id="email" placeholder="Enter email" required>

      <h2>Upload Resume</h2>
      <input type="file" id="resumeUpload" accept=".pdf,.doc,.docx">

      <h2>About Me</h2>
      <textarea id="aboutMe" placeholder="Write a short description about yourself..." rows="4"></textarea>

      <h2>Personalia</h2>
      <label>Current Job Title</label>
      <input type="text" id="jobTitle" placeholder="Your current job title">

      <label>Date of Birth</label>
      <input type="date" id="dob">

      <label>Country</label>
      <input type="text" id="country" placeholder="Enter your country">

      <h2>Contact Information</h2>
      <label>Phone Number</label>
      <input type="text" id="phoneNumber" placeholder="Enter your phone number">

      <label>LinkedIn Username</label>
      <input type="text" id="linkedin" placeholder="LinkedIn username">

      <label>GitHub Username</label>
      <input type="text" id="github" placeholder="GitHub username">

      <h2>Skills</h2>
      <input type="text" id="skills" placeholder="List your skills (e.g., Python, JavaScript)">

      <h2>Experience</h2>
      <textarea id="experience" placeholder="Describe your experience..." rows="3"></textarea>

      <h2>Education</h2>
      <div id="educationSection">
        <div class="education-entry">
          <label>Degree</label>
          <input type="text" placeholder="Enter your degree" name="degree[]">

          <label>Institution</label>
          <input type="text" placeholder="Enter your institution" name="institution[]">
        </div>
      </div>
      <button type="button" class="add-btn" onclick="addEducation()">+ Add Another Degree</button>

      <div class="form-buttons">
        <button type="submit">Save Profile</button>
      </div>
    </form>

    <a class="back-link" href="home.html">&larr; Back to Home</a>
  </div>

  <!-- Scripts -->
  <script>
    // Show welcome username
    const storedUser = JSON.parse(localStorage.getItem('user'));
    if (storedUser) {
      document.getElementById('welcomeUser').innerText = `Welcome, ${storedUser.firstName}`;
    }

    function logout() {
      localStorage.removeItem('user');
      alert("You have been logged out!");
      window.location.href = "index.html";
    }

    window.addEventListener("DOMContentLoaded", function () {
      const storedUser = JSON.parse(localStorage.getItem("user"));
      if (storedUser) {
        document.getElementById("firstName").value = storedUser.firstName || '';
        document.getElementById("lastName").value = storedUser.lastName || '';
        document.getElementById("email").value = storedUser.email || '';
        document.querySelector("h1").innerText = `Welcome, ${storedUser.firstName}!`;
      }
    });

    document.getElementById("profileForm").addEventListener("submit", function (e) {
      e.preventDefault();

      // Save Education
      const degrees = Array.from(document.getElementsByName("degree[]")).map(input => input.value);
      const institutions = Array.from(document.getElementsByName("institution[]")).map(input => input.value);
      const educationDetails = degrees.map((degree, index) => ({
        degree: degree,
        institution: institutions[index]
      }));
      localStorage.setItem("education", JSON.stringify(educationDetails));

      const resumeInput = document.getElementById("resumeUpload");
      const file = resumeInput.files[0];

      // Save other profile details
      const profileData = {
        firstName: document.getElementById("firstName").value,
        lastName: document.getElementById("lastName").value,
        email: document.getElementById("email").value,
        aboutMe: document.getElementById("aboutMe").value,
        jobTitle: document.getElementById("jobTitle").value,
        dob: document.getElementById("dob").value,
        country: document.getElementById("country").value,
        phoneNumber: document.getElementById("phoneNumber").value,
        linkedin: document.getElementById("linkedin").value,
        github: document.getElementById("github").value,
        skills: document.getElementById("skills").value,
        experience: document.getElementById("experience").value
      };
      localStorage.setItem("profile", JSON.stringify(profileData));

      // Update basic user info
      const storedUser = JSON.parse(localStorage.getItem("user"));
      if (storedUser) {
        storedUser.firstName = profileData.firstName;
        storedUser.lastName = profileData.lastName;
        storedUser.email = profileData.email;
        localStorage.setItem("user", JSON.stringify(storedUser));
      }

      // Save Resume and redirect
      if (file) {
        const reader = new FileReader();
        reader.onloadend = function () {
          const base64String = reader.result;
          localStorage.setItem("resumeFile", base64String);
          localStorage.setItem("resumeName", file.name);
          window.location.href = "job.html?title=Developer";
        };
        reader.readAsDataURL(file);
      } else {
        window.location.href = "job.html?title=Developer";
      }
    });

    function addEducation() {
      const educationSection = document.getElementById('educationSection');
      const newEntry = document.createElement('div');
      newEntry.classList.add('education-entry');
      newEntry.innerHTML = `
        <label>Degree</label>
        <input type="text" placeholder="Enter your degree" name="degree[]">
        <label>Institution</label>
        <input type="text" placeholder="Enter your institution" name="institution[]">
      `;
      educationSection.appendChild(newEntry);
    }
  </script>

</body>
</html>
